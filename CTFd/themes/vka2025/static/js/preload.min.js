document.addEventListener('DOMContentLoaded', () => {
  const preloader = document.getElementById('preloader'); // Весь блок
  const imgFilter = document.querySelector('.img_filter');

  const images = Array.from(document.images);
  const bgImages = [];

  // Найти все элементы с background-image
  const allElements = document.querySelectorAll('*');
  allElements.forEach((el) => {
    const bg = getComputedStyle(el).backgroundImage;
    if (bg && bg !== 'none' && bg.includes('url')) {
      const urlMatch = bg.match(/url\(["']?(.+?)["']?\)/);
      if (urlMatch && urlMatch[1]) {
        bgImages.push(urlMatch[1]);
      }
    }
  });

  let total = images.length + bgImages.length;
  let loaded = 0;

  if (total === 0) {
    finishLoading();
    return;
  }

  const checkLoaded = () => {
    loaded++;
    if (loaded >= total) {
      finishLoading();
    }
  };

  images.forEach(img => {
    if (img.complete) {
      checkLoaded();
    } else {
      img.addEventListener('load', checkLoaded);
      img.addEventListener('error', checkLoaded);
    }
  });

  bgImages.forEach(src => {
    const img = new Image();
    img.src = src;
    img.onload = checkLoaded;
    img.onerror = checkLoaded;
  });

  function finishLoading() {
    if (imgFilter) imgFilter.classList.add('fadeout');
    preloader.classList.add('fadeout');

    setTimeout(() => {
      preloader.remove();
    }, 600); // После исчезновения удалить
  }
});
